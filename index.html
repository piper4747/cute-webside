<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>草原世界</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

    <style>
        :root { --meadow-green: #A8D8B0; --sky-blue: #BDE0FE; --paper-white: #F8F7F3; --wood-brown: #D4A373; --sunshine-yellow: #FFE898; }
        body, html { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Nunito', 'M PLUS Rounded 1c', sans-serif; background: linear-gradient(to bottom, var(--sky-blue) 0%, #d4eaff 40%, var(--meadow-green) 40%, var(--meadow-green) 100%); color: #333; overflow-x: hidden; }
        header { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 900px; display: flex; justify-content: space-between; align-items: center; padding: 10px 25px; background-color: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border-radius: 50px; z-index: 100; border: 1px solid rgba(255, 255, 255, 0.2); }
        .logo { font-weight: 700; font-size: 1.2rem; color: var(--wood-brown); }
        .nav-right { display: flex; align-items: center; }
        .auth-button { margin-left: 15px; padding: 8px 18px; border: 2px solid var(--wood-brown); border-radius: 20px; background-color: transparent; color: var(--wood-brown); font-weight: 700; cursor: pointer; transition: all 0.3s; }
        .auth-button.login { background-color: var(--wood-brown); color: white; }
        .auth-button:hover { opacity: 0.8; }
        .user-info { display: none; align-items: center; margin-left: 25px; }
        .user-info .greeting { font-weight: 700; color: #333; }
        #logout-btn { margin-left: 15px; }
        main { padding-top: 100px; }
        .hero-section { display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 50vh; text-align: center; position: relative; }
        .hero-section h1 { font-size: 3rem; color: white; text-shadow: 2px 2px 8px rgba(0,0,0,0.2); margin: 0; }
        .content-section { padding: 80px 5% 0 5%; display: flex; flex-direction: column; align-items: center; }
        .content-card { background-color: var(--paper-white); padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); width: 100%; max-width: 800px; border: 1px solid white; margin-bottom: 80px; }
        .content-card h2 { text-align: center; margin-top: 0; margin-bottom: 30px; color: var(--wood-brown); }
        .comment { display: flex; align-items: flex-start; background-color: #fff; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #eee; }
        .comment-avatar { width: 45px; height: 45px; border-radius: 50%; margin-right: 15px; object-fit: cover; }
        .comment-content { flex: 1; }
        .comment-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .comment-author { font-weight: 700; color: var(--wood-brown); }
        .comment-time { font-size: 0.8em; color: #999; }
        .comment-text { color: #555; word-wrap: break-word; }
        .comment-form textarea { width: 100%; height: 80px; padding: 10px; border-radius: 10px; border: 1px solid #ddd; font-family: inherit; box-sizing: border-box; margin-bottom: 10px; resize: vertical; }
        .comment-form button { display: block; margin-left: auto; padding: 10px 25px; border: none; background-color: var(--wood-brown); color: white; border-radius: 20px; font-weight: 700; cursor: pointer; transition: background-color 0.3s; }
        .comment-form button:hover { background-color: #c48f5a; }
        .modal-overlay { display: none; position: fixed; z-index: 200; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { position: fixed; z-index: 201; left: 50%; top: 50%; transform: translate(-50%, -50%); background-color: var(--paper-white); padding: 20px 40px 40px 40px; border-radius: 20px; width: 90%; max-width: 450px; text-align: center; }
        .modal-close-btn { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }
        .modal-close-btn:hover { color: #000; }
        .modal-content h2 { margin-bottom: 25px; color: var(--wood-brown); }
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 700; color: #555; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .birthday-group { display: flex; gap: 10px; }
        .form-submit-btn { width: 100%; padding: 12px; border: none; background-color: var(--wood-brown); color: white; border-radius: 10px; font-size: 1rem; font-weight: 700; cursor: pointer; margin-top: 10px; }
        .action-buttons { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        .action-buttons .btn { flex-basis: 140px; text-align: center; padding: 10px 20px; border-radius: 20px; border: none; font-weight: 700; cursor: pointer; transition: all 0.2s; }
        .action-buttons .btn-primary { background-color: var(--wood-brown); color: white; }
        .action-buttons .btn-secondary { background-color: #ccc; color: #333; }
        .action-buttons .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        
        /* -- ✨ [修改] 大转盘样式 -- */
        .wheel-container { width: 320px; height: 320px; position: relative; margin: 20px auto; }
        .wheel-pointer { position: absolute; top: -5px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 30px solid #e74c3c; z-index: 10; }
        #lottery-wheel { width: 100%; height: 100%; border-radius: 50%; position: relative; overflow: hidden; border: 8px solid var(--wood-brown); transition: transform 5s cubic-bezier(0.33, 1, 0.68, 1); background: conic-gradient( from -36deg, #fcecae 0deg 72deg, #f8c0b5 72deg 144deg, #bce2e8 144deg 216deg, #d8cdef 216deg 288deg, #b9e0a7 288deg 360deg ); }
        /* -- ✨ [修改] 奖品文字的样式 -- */
        .prize-item {
            position: absolute;
            top: 50%;
            left: 50%;
            /* 将旋转中心设置为转盘的中心 */
            transform-origin: -95px center; 
            margin-top: -10px; /* 根据字体大小微调垂直居中 */
            font-weight: 700;
            font-size: 14px;
            color: #333;
            /* JS会设置transform来定位和旋转 */
        }
        #spin-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80px; height: 80px; border-radius: 50%; background: var(--wood-brown); color: white; border: 5px solid white; font-size: 1.2rem; font-weight: 700; z-index: 10; cursor: pointer; display: flex; justify-content: center; align-items: center; }
        #spin-btn:disabled { background-color: #ccc; cursor: not-allowed; }
        
        .backpack-item { background-color: #fff; padding: 15px; border-radius: 10px; margin-bottom: 10px; text-align: left; }
        .backpack-item-header { display: flex; justify-content: space-between; align-items: center; }
        .backpack-item-name { font-weight: 700; }
        .backpack-item-details { margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; font-size: 0.9em; color: #555; }
        .backpack-item-details h4 { margin-top: 0; }
        .backpack-item-details p { margin-bottom: 5px; }
        .backpack-item-details strong { color: var(--wood-brown); }
        .date-selection button { margin: 5px; }
        .date-selection button.selected { background-color: var(--wood-brown); color: white; border-color: var(--wood-brown); }
    </style>
</head>
<body>
    <header>
        <div class="logo">草原世界</div>
        <div class="nav-right">
            <div id="auth-container">
                <button id="register-btn" class="auth-button">注册</button>
                <button id="login-btn" class="auth-button login">登录</button>
            </div>
            <div id="user-info-container" class="user-info">
                <span class="greeting"></span>
                <button id="backpack-btn" class="auth-button">个人背包</button>
                <button id="logout-btn" class="auth-button">退出</button>
            </div>
        </div>
    </header>

    <main>
        <section class="hero-section"><h1>欢迎来到我们的草原</h1></section>
        <section id="special-event-section" class="content-section" style="display: none;"><div class="content-card"><h2>特殊活动</h2><p>亲爱的<span id="event-username"></span>，系统检测到，您的生日还剩 <strong id="birthday-countdown" style="color:var(--wood-brown); font-size:1.2em;"></strong> 天，草原伙伴将为您举办生日庆祝活动，您想来参加吗？</p><div class="action-buttons"><button id="event-confirm-btn" class="btn btn-primary">确认参加</button><button id="event-decline-btn" class="btn btn-secondary">不想凑热闹</button></div></div></section>
        <section id="comments" class="content-section"><div class="content-card"><h2>分享你的想法</h2><div id="comment-list" class="comment-list"></div><hr style="margin: 30px 0; border: 1px solid #eee;"><div class="comment-form"><textarea id="comment-input" placeholder="登录后才能发表想法哦..."></textarea><button id="post-comment-btn">发表评论</button></div></div></section>
    </main>
    
    <div id="register-modal" class="modal-overlay"><div class="modal-content"><span class="modal-close-btn">&times;</span><h2>加入草原</h2><form id="register-form"><div class="form-group"><label>用户名</label><input type="text" id="reg-username"></div><div class="form-group"><label>密码</label><input type="password" id="reg-password"></div><div class="form-group"><label>头像 (图片链接)</label><input type="text" id="reg-avatar" placeholder="请粘贴有效的图片网址"></div><div class="form-group"><label>生日</label><div class="birthday-group"><select id="reg-birth-year"></select><select id="reg-birth-month"></select><select id="reg-birth-day"></select></div></div><button type="submit" class="form-submit-btn">立即注册</button></form></div></div>
    <div id="login-modal" class="modal-overlay"><div class="modal-content"><span class="modal-close-btn">&times;</span><h2>回到草原</h2><form id="login-form"><div class="form-group"><label>用户名</label><input type="text" id="login-username"></div><div class="form-group"><label>密码</label><input type="password" id="login-password"></div><button type="submit" class="form-submit-btn">登录</button></form></div></div>
    <div id="lottery-prompt-modal" class="modal-overlay"><div class="modal-content"><span class="modal-close-btn">&times;</span><h2>惊喜抽奖</h2><p>草原伙伴为您准备了一份抽奖大礼，您要试试看吗？</p><div class="action-buttons"><button id="lottery-confirm-btn" class="btn btn-primary">确认</button><button id="lottery-decline-btn" class="btn btn-secondary">不想凑热闹</button></div></div></div>
    <div id="lottery-wheel-modal" class="modal-overlay"><div class="modal-content"><span class="modal-close-btn">&times;</span><h2>幸运大转盘</h2><div class="wheel-container"><div class="wheel-pointer"></div><div id="lottery-wheel"></div><button id="spin-btn">开始抽奖</button></div></div></div>
    <div id="prize-modal" class="modal-overlay"><div class="modal-content"><span class="modal-close-btn">&times;</span><h2>恭喜中奖！</h2><p>您获得了：<strong id="prize-name" style="font-size:1.5em; color: var(--wood-brown);"></strong></p><p>奖品已放置您的个人背包里！</p></div></div>
    <div id="backpack-modal" class="modal-overlay"><div class="modal-content"><span class="modal-close-btn">&times;</span><h2>个人背包</h2><div id="backpack-list"></div></div></div>
    <div id="redeem-modal" class="modal-overlay"><div class="modal-content"><span class="modal-close-btn">&times;</span><h2>神秘大奖揭晓！</h2><p>恭喜您，您的神秘大奖是【Mystery Day】！</p><hr><div style="text-align: left; margin-top: 20px;"><h4>如何使用：</h4><p>请在以下几天选择一天，由于mystery性质，我们无法透露您当天要做什么，您在选择日期之后，请在该日期当天早晨7点准时到达【西土城】地铁站，享受【Mystery Day】！</p><h4>我需要提前准备什么：</h4><p>请您凭感觉准备【Mystery Day】需要带的东西，活动将在夜晚结束，请您自行评估。</p></div><div id="date-selection-container" class="date-selection"><h4>日期选择：</h4><button data-day="8月25日" class="btn btn-secondary">8月25日</button><button data-day="8月26日" class="btn btn-secondary">8月26日</button><button data-day="8月27日" class="btn btn-secondary">8月27日</button><button data-day="8月28日" class="btn btn-secondary">8月28日</button></div><button id="final-confirm-btn" class="form-submit-btn" style="margin-top: 20px;">确认选择</button></div></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            AV.init({
                appId: "ERP3gC0G0Pdrnor7rSpDDIVT-gzGzoHsz",
                appKey: "Gj5IaBMkgKj0uQ4RvejArDXu",
                serverURL: "https://erp3gc0g.lc-cn-n1-shared.com"
            });

            // --- 全局元素获取 ---
            // ✨ [修改] 添加 lotteryDeclineBtn
            const authContainer = document.getElementById('auth-container'), userInfoContainer = document.getElementById('user-info-container'), greetingSpan = document.querySelector('.user-info .greeting'), logoutBtn = document.getElementById('logout-btn'), registerForm = document.getElementById('register-form'), loginForm = document.getElementById('login-form'), specialEventSection = document.getElementById('special-event-section'), eventConfirmBtn = document.getElementById('event-confirm-btn'), eventDeclineBtn = document.getElementById('event-decline-btn'), commentInput = document.getElementById('comment-input'), postButton = document.getElementById('post-comment-btn'), commentList = document.getElementById('comment-list'), backpackBtn = document.getElementById('backpack-btn'), backpackModal = document.getElementById('backpack-modal'), backpackList = document.getElementById('backpack-list'), redeemModal = document.getElementById('redeem-modal'), dateSelectionContainer = document.getElementById('date-selection-container'), finalConfirmBtn = document.getElementById('final-confirm-btn'), lotteryConfirmBtn = document.getElementById('lottery-confirm-btn'), lotteryDeclineBtn = document.getElementById('lottery-decline-btn'), lotteryWheelModal = document.getElementById('lottery-wheel-modal'), spinBtn = document.getElementById('spin-btn'), lotteryWheel = document.getElementById('lottery-wheel'), prizeModal = document.getElementById('prize-modal'), registerBtn = document.getElementById('register-btn'), loginBtn = document.getElementById('login-btn'), lotteryPromptModal = document.getElementById('lottery-prompt-modal');
            let selectedDate = null;

            // --- 弹窗通用逻辑 ---
            const openModal = (modal) => { if(modal) modal.style.display = 'block'; };
            const closeModal = (modal) => { if(modal) modal.style.display = 'none'; };
            const allModals = document.querySelectorAll('.modal-overlay');
            const allCloseBtns = document.querySelectorAll('.modal-close-btn');
            registerBtn.addEventListener('click', () => openModal(document.getElementById('register-modal')));
            loginBtn.addEventListener('click', () => openModal(document.getElementById('login-modal')));
            allCloseBtns.forEach(btn => btn.addEventListener('click', (e) => e.target.closest('.modal-overlay').style.display = 'none' ));
            window.addEventListener('click', (e) => { if (e.target.classList.contains('modal-overlay')) closeModal(e.target); });

            // --- 核心功能函数 ---
            const updateNavUI = (user) => { if (user) { authContainer.style.display = 'none'; userInfoContainer.style.display = 'flex'; greetingSpan.textContent = `你好, ${user.get('username')}`; } else { authContainer.style.display = 'flex'; userInfoContainer.style.display = 'none'; } };
            const formatTime = (date) => { const now = new Date(); const diff = now - date; const minutes = Math.floor(diff / 60000); if (minutes < 1) return '刚刚'; if (minutes < 60) return `${minutes}分钟前`; const hours = Math.floor(minutes / 60); if (hours < 24) return `${hours}小时前`; return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`; };
            const loadComments = () => { commentList.innerHTML = '<p>正在加载评论...</p>'; const query = new AV.Query('Comment'); query.descending('createdAt'); query.find().then((comments) => { commentList.innerHTML = ''; if (comments.length === 0) { commentList.innerHTML = '<p>还没有人留下足迹哦~</p>'; return; } comments.forEach((c) => { const div = document.createElement('div'); div.className = 'comment'; div.innerHTML = `<img src="${c.get('authorAvatar') || 'https://i.pravatar.cc/150?u=guest'}" class="comment-avatar"><div class="comment-content"><div class="comment-header"><span class="comment-author">${c.get('authorName')}</span><span class="comment-time">${formatTime(c.createdAt)}</span></div><p class="comment-text">${c.get('content')}</p></div>`; commentList.appendChild(div); }); }).catch(error => { commentList.innerHTML = '<p>评论加载失败...</p>'; }); };
            const calculateAndShowBirthdayEvent = (user) => { const b = user.get('birthday'); if (!b) return; const t = new Date(); t.setHours(0, 0, 0, 0); const bM = b.getMonth(), bD = b.getDate(); let nB = new Date(t.getFullYear(), bM, bD); if (nB < t) { nB.setFullYear(t.getFullYear() + 1); } const dD = Math.ceil((nB - t) / 864e5); document.getElementById('event-username').textContent = user.get('username'); document.getElementById('birthday-countdown').textContent = dD; specialEventSection.style.display = 'flex'; };
            const initializePage = () => { const currentUser = AV.User.current(); updateNavUI(currentUser); loadComments(); if (currentUser) { currentUser.fetch().then(latestUser => { updateNavUI(latestUser); if (latestUser.get('hasSpunLottery')) { specialEventSection.style.display = 'none'; } else { calculateAndShowBirthdayEvent(latestUser); } }).catch(error => console.error("获取最新用户信息失败:", error)); } };

            // --- 事件监听器 ---
            registerForm.addEventListener('submit', (e) => { e.preventDefault(); const u = document.getElementById('reg-username').value.trim(), p = document.getElementById('reg-password').value.trim(), a = document.getElementById('reg-avatar').value.trim(); if (!u || !p || !a) { alert('所有信息均为必填项！'); return; } const y = document.getElementById('reg-birth-year').value, m = document.getElementById('reg-birth-month').value, d = document.getElementById('reg-birth-day').value, b = new Date(y, m - 1, d); const user = new AV.User(); user.setUsername(u); user.setPassword(p); user.set('birthday', b); user.set('avatar', a); user.signUp().then(() => { alert('注册成功!'); location.reload(); }, (err) => alert('注册失败: ' + err.message)); });
            loginForm.addEventListener('submit', (e) => { e.preventDefault(); const u = document.getElementById('login-username').value, p = document.getElementById('login-password').value; AV.User.logIn(u, p).then(() => { alert('登录成功!'); location.reload(); }, (err) => alert('登录失败: ' + err.message)); });
            logoutBtn.addEventListener('click', () => { AV.User.logOut(); alert('已退出登录。'); location.reload(); });
            postButton.addEventListener('click', () => { const user = AV.User.current(); if (!user) { alert('请先登录再发表评论哦！'); return; } const text = commentInput.value; if (!text.trim()) { alert('评论内容不能为空哦！'); return; } const Comment = AV.Object.extend('Comment'); const c = new Comment(); c.set('content', text); c.set('authorName', user.get('username')); c.set('authorAvatar', user.get('avatar')); c.save().then(() => { commentInput.value = ''; loadComments(); }); });
            eventConfirmBtn.addEventListener('click', () => { specialEventSection.style.display = 'none'; openModal(lotteryPromptModal); });
            eventDeclineBtn.addEventListener('click', () => { if(confirm('真的要错过草原伙伴们的好意吗？')){ specialEventSection.style.display = 'none'; }});
            lotteryConfirmBtn.addEventListener('click', () => { closeModal(lotteryPromptModal); openModal(lotteryWheelModal); });
            // ✨ [新增] 为“不想凑热闹”按钮添加关闭弹窗的事件
            lotteryDeclineBtn.addEventListener('click', () => closeModal(lotteryPromptModal));

            // ✨ [修改] 抽奖按钮点击事件
            spinBtn.addEventListener('click', () => {
                const user = AV.User.current();
                if (!user) return;
                spinBtn.disabled = true;

                // 计算旋转角度以固定停在“神秘大奖”
                // 神秘大奖(index=4)的中心角度是288度，指针在270度
                // 需要旋转的角度 = 5个整圈 - 18度
                const angle = (360 * 5) - 18; 
                lotteryWheel.style.transform = `rotate(${angle}deg)`;

                setTimeout(() => {
                    user.set('hasSpunLottery', true);
                    user.addUnique('backpackItems', '神秘大奖');
                    user.save().then(() => {
                        document.getElementById('prize-name').textContent = '神秘大奖';
                        closeModal(lotteryWheelModal);
                        openModal(prizeModal);
                        console.log('用户状态已保存');
                    }).catch(err => {
                        alert('保存抽奖结果失败，请重试');
                        console.error(err);
                        spinBtn.disabled = false;
                    });
                }, 5500); // 等待动画结束
            });

            backpackBtn.addEventListener('click', () => { const user = AV.User.current(); if (!user) { alert('请先登录哦！'); return; } user.fetch().then(latestUser => { const items = latestUser.get('backpackItems') || []; const chosenDay = latestUser.get('day'); backpackList.innerHTML = ''; if (items.length === 0) { backpackList.innerHTML = '<p>你的背包空空如也~</p>'; } else { items.forEach(itemName => { const itemDiv = document.createElement('div'); itemDiv.className = 'backpack-item'; if (itemName === '神秘大奖' && chosenDay) { itemDiv.innerHTML = `<div class="backpack-item-header"><span class="backpack-item-name">【Mystery Day】</span></div><div class="backpack-item-details"><h4>如何使用：</h4><p>请在该日期当天早晨7点准时到达【西土城】地铁站，享受【Mystery Day】！</p><h4>我需要提前准备什么：</h4><p>请您凭感觉准备【Mystery Day】需要带的东西，活动将在夜晚结束，请您自行评估。</p><p><strong>您选择的日期是：${chosenDay}</strong></p></div>`; } else if (itemName === '神秘大奖') { itemDiv.innerHTML = `<div class="backpack-item-header"><span class="backpack-item-name">${itemName}</span><button class="btn btn-primary redeem-btn">兑换</button></div>`; itemDiv.querySelector('.redeem-btn').onclick = () => { closeModal(backpackModal); openModal(redeemModal); }; } else { itemDiv.innerHTML = `<span class="backpack-item-name">${itemName}</span>`; } backpackList.appendChild(itemDiv); }); } openModal(backpackModal); }); });
            dateSelectionContainer.addEventListener('click', (e) => { if (e.target.tagName === 'BUTTON') { dateSelectionContainer.querySelectorAll('button').forEach(btn => btn.classList.remove('selected')); e.target.classList.add('selected'); selectedDate = e.target.dataset.day; } });
            finalConfirmBtn.addEventListener('click', () => { if (!selectedDate) { alert('请先选择一个日期哦！'); return; } const user = AV.User.current(); if (!user) return; user.set('day', selectedDate); user.save().then(() => { alert(`选择成功！您的【Mystery Day】是 ${selectedDate}，请准时赴约！`); closeModal(redeemModal); }); });
            
            // --- 初始化函数 ---
            const populateBirthdaySelects = () => { const y = document.getElementById('reg-birth-year'), m = document.getElementById('reg-birth-month'), d = document.getElementById('reg-birth-day'), cY = new Date().getFullYear(); for (let i = cY; i >= 1950; i--) { const o=document.createElement('option'); o.value=i; o.textContent=i+'年'; y.appendChild(o); } for (let i = 1; i <= 12; i++) { const o=document.createElement('option'); o.value=i; o.textContent=i+'月'; m.appendChild(o); } for (let i = 1; i <= 31; i++) { const o=document.createElement('option'); o.value=i; o.textContent=i+'日'; d.appendChild(o); } };
            
            // ✨ [修改] 重写转盘设置函数
            const setupLotteryWheel = () => {
                const prizes = ["平果手机", "abibas运动鞋", "汪汪大礼包", "任天唐游戏机", "神秘大奖"];
                const wheel = document.getElementById('lottery-wheel');
                wheel.innerHTML = '';
                const angleStep = 360 / prizes.length; // 72deg

                // conic-gradient的from使得第一个扇区的中心点在0度
                const gradientOffset = -36;

                prizes.forEach((prize, index) => {
                    const prizeDiv = document.createElement('div');
                    prizeDiv.className = 'prize-item';
                    prizeDiv.textContent = prize;

                    // 计算每个奖品文字的中心角度
                    const textAngle = (index * angleStep) + (angleStep / 2) + gradientOffset;
                    
                    // 通过 transform 定位文字
                    // 1. rotate(textAngle) - 把文字“指针”指向正确方向
                    // 2. translateX(95px) - 把文字从中心推到外圈
                    // 3. rotate(-textAngle) - 把文字本身转回水平
                    let finalTransform = `rotate(${textAngle}deg) translateX(95px) rotate(${-textAngle}deg)`;

                    // 如果文字在转盘左侧 (90~270度)，则再旋转180度使其保持正向
                    if (textAngle > 90 && textAngle < 270) {
                        finalTransform = `rotate(${textAngle}deg) translateX(95px) rotate(${-textAngle + 180}deg)`;
                    }
                    
                    prizeDiv.style.transform = finalTransform;
                    wheel.appendChild(prizeDiv);
                });
            };
            
            populateBirthdaySelects();
            setupLotteryWheel();
            initializePage();
        });
    </script>
</body>
</html>